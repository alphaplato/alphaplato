## 特征工程一些思考

### 1、为什么要做特征交叉？
**直接原因是提高训练的非线性能力**，这里有一篇文章介绍地非常好了，见[《互联网特征工程》](https://blog.csdn.net/mytestmy/article/details/19088827)。

> 比如一个人是20岁，**那么在编号为2的特征上面，它一直都是1，对篮球的广告是1，对化妆品的广告也是1，这样训练的结果得到的编号为2的权重的意义是——20岁的人点击所有的广告的可能性的都是这个权重，这样其实是不合理的。**  

>有意义的应该是，这个20岁的人，当广告是跟体育相关的时候，它是一个值；当广告跟保健品相关的时候，它又是一个值。这样看起来才合理。如果这个不够深刻，**基于跟上面同样的道理，性别这个特征也是一样的，假如也做了上面的离散化操作，编号是12和13,12是男性，13是女性。这样的话，对于一个男性/体育广告组合来说，编号12的特征值为1，男性/化妆品的组合的编号12的特征值也是1。这样也是不合理的。**  

>怎么做到合理呢？以上面的性别的例子来说。编号12的特征值不取1，取值为该广告在男性用户上面的点击率，如对于男性/体育广告的组合，编号12的特征的值为男性在体育广告上面点击率，这样，编号为12的特征就变成了一个浮点数，这个浮点数的相加减是有意义的。  

>这样的做法称为特征的交叉，现在就是性别跟广告的交叉得到的特征值。还有很多其他的方式可以进行交叉，**目前工业上的应用最多的就是广告跟用户的交叉特征（编号为1的那个特征）（注：1号特征上文指广告反馈ctr）、广告跟性别的交叉特征，广告跟年龄的交叉特征，广告跟手机平台的交叉特征，广告跟地域的交叉特征。如果做得比较多，可能会有广告主（每个广告都是一个广告主提交的一个投放计划，一个广告主可能会提交多个投放计划）跟各个特征的交叉。**   --- 摘自《互联网特征工程》

**正如《互联网特征工程》前文所述，在线性模型（比如逻辑斯蒂回归）这样做是提高模型非线性非常有效的方法；提高模型的非线性，通常意味着提高了模型的个性化学习能力。**

值得说明的是，在上文中“编号12的特征的值为男性在体育广告上面点击率”的方法有待商榷，或者作者说的还不够严谨，正确的方法应该是新增一个特征未知比如23，编号12的特征不变，编号23的特征的值为男性在体育广告上面点击率，这个样更加科学。因为23的特征相当于是12的特征细分，而12是粗粒度的特征，粗粒度的特征 依然是有意义的。尤其当时用GBDT这样的模型时，就是必须的了。

正如上文所说，为了提高非线性，特征的构建一定是基于两维（及两维以上）的交叉实现的，比如“男性”“体育”；基于这种构建通常有两种模式：

* 1、以CTR为目标的连续值构建；如上文所述；
* 2、以类别特征交叉的离散值构建；比如“男性”“体育”的类别特征组合成的新特征“男性-体育”的类别特征。

通常来说，对于线性模型，2的方法会更直观，因为本质上1的方法“男性”“体育”的ctr特征是一个固定的值，在意义上和2几乎接近。不同主要有一下两点：

* 1、以CTR为目标的特征是连续的；类别组合的特征是离散的；
* 2、CTR为目标的特征是连续的可以是分不同的时间段，不如7天、30天，从更多时间维度刻画；类别组合的特征是全局的。

### 2、深度学习还需要特征交叉吗？
不需要，**至少不需要构造太多高级特征。**正如尚未开始所述，特征工程**直接原因是提高训练的非线性能力。显然，深度模型本身提高的就是模型的非线性能力。**

从这个意义上说，在深度学习的背景下，要把特征交叉的能力留给模型。像逐渐诞生的DCN，DeepFM，XDeepFM本身 就是为了提高模型对特征交叉利用能力。在这种背景下，越简单越有说明意义的特征，从工程上讲，越有利于长期的模型优化。

#### 1、深度学习可以应用于任何类型的数据

* 声音（语音识别）
* 文本（评价分类）
* 图像（计算机视觉）
* 时间序列（传感器数据、网页活动）
* 视频（动作检测）
* …

具体的数据类型和需要收集的数据取决于您想要解决的问题，但说明了一点就是深度学习大大开拓了特征应用的范围，这意味着有更多的原始特征可以刻画数据，而且是基于原始数据形成的。**因此，多模态将是未来算法模型的必然趋势**。这也意味着人工构造特征越来越不适用。

#### 2、深度学习应遵循最低数据要求

数据最低要求包括两个方面：
* 特征最小化
* 样本最小化

特征最小化指尽可能应用最少的特征达到最好的模型效果，往往对应的策略有主成分分析法（PCA）、线性判别分析法（LDA）等；样本最小化意味着能够应用最少的样本达到模型收敛，这时候就需要通过AUC或ACC曲线进行欠拟合的判断。

当然，问题的复杂度不同，最低数据要求也会有所区别，但通常可以先考虑准备10万个实例的数据（包括所有类别）。如果采用已标记数据（即数据已分为A、B、C、D等类别），最好确保数据集中各类数据的比例一致，每种标签有2.5万个实例，即A类有2.5万个实例、B类有2.5万个实例，以此类推。

**基于以上可以有这样的结论：首先深度模型本身具备特征交叉的能力，即非线性的能力；其次，深度学习大大特征的应用范围，意味可以利用的特征形态和范围更广，那么特征工程的必要性下降；最后，最低数据的要求和人工构造特征存在相悖的地方，因为人工构造难免出现冗余特征。**

### 3、深度学习的特征工程应该怎样做？

有了以上特征交叉意义和深度模型下特征交叉的不必要性分析，可知在深度学习模型上，特征工程的地位大大下降。那么还有哪些准则是要遵循的呢？

1、模型的多模态    
2、类型化不交叉

多模态即
* 声音（语音识别）
* 文本（评价分类）
* 图像（计算机视觉）
* 时间序列（传感器数据、网页活动）
* 视频（动作检测）
* …

类型化不交叉是指构造特征时在多侧面构造，单不在进行交叉特征的构造，比如广告系统特征主要分为User和Ad两个范围的特征，传统的特征工程会构造User和Ad的交叉特征，在深度模型下则不再需要，但是像User侧本身的特征，比如本身CTR和广告侧本身的CTR连续特征构造还是有用的，但是更像是退化成用户画像和广告画像。

最后，构造交叉特征以减轻模型的复杂也是ok的。
